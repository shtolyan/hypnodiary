<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>–°–ø–∏—Å–æ–∫ —Å–µ–∞–Ω—Å–æ–≤</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <div class="container">
      <h1>–°–ø–∏—Å–æ–∫ —Å–µ–∞–Ω—Å–æ–≤</h1>
      <div style="background: #1e1e1e; color: #f0f0f0; padding: 20px; border-radius: 16px; font-family: 'Segoe UI', sans-serif; line-height: 1.6; max-width: 400px;">
        <h3 style="color: #80caff; margin-top: 0;">üîÑ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ä–∞–±–æ—Ç–æ–∫</h3>
        
        <p>‚ú® <strong>–ü—Ä–æ–≤—ë–ª:</strong> <span style="color:#a1ffa1; font-weight: bold;"><%= iGave %></span></p>
        <p>üßò‚Äç‚ôÇÔ∏è <strong>–ü–æ–ª—É—á–∏–ª:</strong> <span style="color:#ffd580; font-weight: bold;"><%= iReceived %></span></p>
        <hr style="border: none; border-top: 1px solid #444; margin: 10px 0;">
        <p>üìä <strong>–í—Å–µ–≥–æ –ø—Ä–æ—Ä–∞–±–æ—Ç–æ–∫:</strong> <span style="color:#ff8cbc; font-weight: bold;"><%= total %></span></p>
      </div>
      <p><a href="/sessions/new">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ–∞–Ω—Å</a></p>

      <!-- –î–æ–±–∞–≤–∏–ª–∏ id="sessionsTable" -->
      <table id="sessionsTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>–î–∞—Ç–∞</th>
            <th>–§–∞–º–∏–ª–∏—è</th>
            <th>–ò–º—è</th>
            <th>–§–æ—Ä–º–∞—Ç</th>
            <th>–í–∏–¥–µ–æ —Å–µ–∞–Ω—Å–∞</th>
            <th>–í–∏–¥–µ–æ-–æ—Ç–∑—ã–≤</th>
            <th>–î–µ—Ç–∞–ª–∏</th>
          </tr>
        </thead>
        <tbody>
          <% sessions.forEach(session => { %>
            <tr>
              <td><%= session.id %></td>
              <td><%= session.date %></td>
              <td><%= session.surname %></td>
              <td><%= session.name %></td>
              <td><%= session.sessionType %></td>
              <td>
                <% if (session.therapyLink) { %>
                  <a href="<%= session.therapyLink %>" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
                <% } else { %>
                  -
                <% } %>
              </td>
              <td>
                <% if (session.feedbackLink) { %>
                  <a href="<%= session.feedbackLink %>" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
                <% } else { %>
                  -
                <% } %>
              </td>
              <td>
                <a href="/sessions/<%= session.id %>">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a> | 
                <a href="/sessions/<%= session.id %>/edit">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const table = document.getElementById('sessionsTable');
        const headers = table.querySelectorAll('thead th');
        
        // –ë—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞
        // true = –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é, false = –ø–æ —É–±—ã–≤–∞–Ω–∏—é
        let sortDirections = {};

        headers.forEach((header, index) => {
          header.addEventListener('click', () => {
            // –ü–æ–ª—É—á–∞–µ–º tbody –∏ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
            const tb = table.tBodies[0];
            let rows = Array.from(tb.rows);

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:
            // –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∫–ª–∏–∫–∞–µ–º –ø–æ —ç—Ç–æ–º—É —Å—Ç–æ–ª–±—Ü—É, —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é,
            // –µ—Å–ª–∏ –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ ‚Äî –º–µ–Ω—è–µ–º –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—É—é.
            let currentDirection = sortDirections[index];
            let isAscending = currentDirection === undefined ? true : !currentDirection;
            sortDirections[index] = isAscending;

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏
            rows.sort((rowA, rowB) => {
              // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —è—á–µ–µ–∫, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –∏–¥—ë—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
              let cellA = rowA.cells[index].innerText.trim();
              let cellB = rowB.cells[index].innerText.trim();

              // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —á–∏—Å–ª–∞, –∏–Ω–∞—á–µ —Å–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏
              let valA = parseFloat(cellA.replace(',', '.'));
              let valB = parseFloat(cellB.replace(',', '.'));

              // –ï—Å–ª–∏ –æ–±–∞ - —ç—Ç–æ —á–∏—Å–ª–æ, —Å–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞–∫ —á–∏—Å–ª–∞, –∏–Ω–∞—á–µ - –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏
              if (!isNaN(valA) && !isNaN(valB)) {
                return isAscending ? valA - valB : valB - valA;
              } else {
                // –î–ª—è —Å—Ç—Ä–æ–∫
                if (cellA < cellB) return isAscending ? -1 : 1;
                if (cellA > cellB) return isAscending ? 1 : -1;
                return 0;
              }
            });

            // –ü–µ—Ä–µ—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
            rows.forEach((row) => tb.appendChild(row));
          });
        });
      });
    </script>
  </body>
</html>